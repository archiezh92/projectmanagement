<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .nav-tab.active {
            background: #4c1d95;
            color: white;
        }
        
        .content-area {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #4c1d95;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon {
            font-size: 1.5em;
        }
        
        .subsection {
            margin-bottom: 20px;
        }
        
        .subsection-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .data-item, .model-item, .capability-item, .product-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .item-title {
            font-weight: 600;
            color: #4c1d95;
        }
        
        .add-btn, .remove-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .add-btn {
            background: #667eea;
            color: white;
            margin-top: 10px;
        }
        
        .add-btn:hover {
            background: #5568d3;
        }
        
        .remove-btn {
            background: #dc3545;
            color: white;
        }
        
        .remove-btn:hover {
            background: #c82333;
        }
        
        .save-btn {
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: all 0.3s;
        }
        
        .save-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .input-group {
            margin-bottom: 10px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }
        
        .relation-select {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }
        
        .relation-label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 13px;
        }
        
        select[multiple] {
            min-height: 80px;
        }
        
        .flow-diagram {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .flow-step {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .flow-arrow {
            font-size: 20px;
            font-weight: bold;
        }
        
        .summary-section {
            margin-bottom: 30px;
        }
        
        .product-summary {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #667eea;
        }
        
        .product-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #4c1d95;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trace-path {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .trace-step {
            margin-bottom: 15px;
            padding-left: 20px;
            border-left: 3px solid #667eea;
        }
        
        .trace-step-title {
            font-weight: 600;
            color: #4c1d95;
            margin-bottom: 8px;
        }
        
        .trace-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .trace-item-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .trace-item-detail {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
        }
        
        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 5px;
        }
        
        .tag-internal {
            background: #d4edda;
            color: #155724;
        }
        
        .tag-external {
            background: #cce5ff;
            color: #004085;
        }
        
        .no-data {
            text-align: center;
            color: #999;
            padding: 40px;
            font-size: 16px;
        }
    
    /* Firebaseè®¤è¯æ ·å¼ */
    .auth-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .auth-container {
        max-width: 420px;
        width: 90%;
        padding: 40px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .auth-logo {
        text-align: center;
        font-size: 3em;
        margin-bottom: 10px;
    }
    
    .auth-title {
        text-align: center;
        color: #4c1d95;
        margin-bottom: 30px;
        font-size: 1.8em;
    }
    
    .auth-input {
        width: 100%;
        padding: 14px;
        margin-bottom: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 15px;
        transition: all 0.3s;
    }
    
    .auth-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
    
    .auth-button {
        width: 100%;
        padding: 14px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 12px;
        transition: all 0.3s;
    }
    
    .auth-button:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102,126,234,0.3);
    }
    
    .auth-button.google {
        background: #DB4437;
    }
    
    .auth-button.google:hover {
        background: #c23321;
    }
    
    .auth-switch {
        text-align: center;
        margin-top: 20px;
        color: #666;
        font-size: 14px;
    }
    
    .auth-link {
        color: #667eea;
        cursor: pointer;
        font-weight: 600;
        text-decoration: none;
    }
    
    .auth-link:hover {
        text-decoration: underline;
    }
    
    .user-bar {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 12px 20px;
        border-radius: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 15px;
        z-index: 1000;
    }
    
    .user-email {
        font-size: 14px;
        color: #495057;
        font-weight: 500;
    }
    
    .sync-status {
        font-size: 12px;
        padding: 4px 10px;
        border-radius: 12px;
        font-weight: 600;
    }
    
    .sync-status.synced {
        background: #d4edda;
        color: #155724;
    }
    
    .sync-status.syncing {
        background: #fff3cd;
        color: #856404;
    }
    
    .sync-status.error {
        background: #f8d7da;
        color: #721c24;
    }
    
    .logout-btn {
        padding: 6px 16px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.3s;
    }
    
    .logout-btn:hover {
        background: #c82333;
        transform: translateY(-1px);
    }
    
    .hidden {
        display: none !important;
    }
    
    .auth-error {
        background: #f8d7da;
        color: #721c24;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 15px;
        font-size: 14px;
        text-align: center;
    }

    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

</head>
<body>
    <!-- Firebaseè®¤è¯ç•Œé¢ -->
    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-container">
            <div class="auth-logo">ğŸš€</div>
            <h2 class="auth-title">é¡¹ç›®ç®¡ç†ç³»ç»Ÿ</h2>
            
            <div id="auth-error" class="auth-error hidden"></div>
            
            <!-- ç™»å½•è¡¨å• -->
            <div id="login-form">
                <input type="email" id="login-email" class="auth-input" placeholder="é‚®ç®±åœ°å€" autocomplete="email">
                <input type="password" id="login-password" class="auth-input" placeholder="å¯†ç " autocomplete="current-password">
                <button class="auth-button" onclick="handleLogin()">ç™»å½•</button>
                <button class="auth-button google" onclick="handleGoogleLogin()">
                    <span style="margin-right: 8px;">ğŸŒ</span> ä½¿ç”¨ Google ç™»å½•
                </button>
                <div class="auth-switch">
                    è¿˜æ²¡æœ‰è´¦å·? <a class="auth-link" onclick="showRegister()">ç«‹å³æ³¨å†Œ</a>
                </div>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div id="register-form" class="hidden">
                <input type="email" id="register-email" class="auth-input" placeholder="é‚®ç®±åœ°å€" autocomplete="email">
                <input type="password" id="register-password" class="auth-input" placeholder="å¯†ç  (è‡³å°‘6ä½)" autocomplete="new-password">
                <input type="password" id="register-password-confirm" class="auth-input" placeholder="ç¡®è®¤å¯†ç " autocomplete="new-password">
                <button class="auth-button" onclick="handleRegister()">æ³¨å†Œ</button>
                <div class="auth-switch">
                    å·²æœ‰è´¦å·? <a class="auth-link" onclick="showLogin()">è¿”å›ç™»å½•</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
    <div id="user-bar" class="user-bar hidden">
        <span class="user-email" id="user-email-display"></span>
        <span class="sync-status synced" id="sync-status">å·²åŒæ­¥ âœ“</span>
        <button class="logout-btn" onclick="handleLogout()">é€€å‡º</button>
    </div>


    <div class="container">
        <h1>ğŸš€ äº”é¡¹ç›®ç®¡ç†ç³»ç»Ÿ</h1>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('silicon-human')">ç¡…åŸºäººåŠ›</button>
            <button class="nav-tab" onclick="switchTab('silicon-colleague')">ç¡…åŸºåŒäº‹</button>
            <button class="nav-tab" onclick="switchTab('base-model')">åŸºåº§æ¨¡å‹</button>
            <button class="nav-tab" onclick="switchTab('space-robot')">ç©ºé—´æœºå™¨äºº</button>
            <button class="nav-tab" onclick="switchTab('wearable-robot')">ç©¿æˆ´æœºå™¨äºº</button>
            <button class="nav-tab" onclick="switchTab('summary')">ğŸ“Š äº§å“æ±‡æ€»</button>
        </div>
        
        <div class="content-area">
            <!-- ç¡…åŸºäººåŠ› -->
            <div id="silicon-human" class="tab-content active">
                <h2 style="margin-bottom: 20px; color: #4c1d95;">ç¡…åŸºäººåŠ›</h2>
                
                <!-- æ•°æ®æµå‘å›¾ -->
                <div class="flow-diagram">
                    <span class="flow-step">æ•°æ®è¦ç´ </span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">åŸºåº§æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">èƒ½åŠ›æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">äº§å“è¾“å‡º</span>
                    <br>
                    <span style="font-size: 12px; opacity: 0.8;">æ”¯æŒçµæ´»è¿æ¥:æ•°æ®å¯ç›´æ¥åˆ°èƒ½åŠ›æ¨¡å‹,åŸºåº§æ¨¡å‹å¯ç›´æ¥åˆ°äº§å“</span>
                </div>
                
                <!-- å¿ƒè„éƒ¨åˆ† -->
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ’—</div>
                        å¿ƒè„ï¼ˆç®—åŠ›ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">è®­ç»ƒç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="sh-training-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ¨ç†ç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="sh-inference-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">ç¡¬ä»¶è½½ä½“</div>
                        <textarea placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="sh-hardware"></textarea>
                    </div>
                </div>
                
                <!-- å¤§è„‘éƒ¨åˆ† -->
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ§ </div>
                        å¤§è„‘
                    </div>
                    
                    <!-- æ•°æ®è¦ç´  -->
                    <div class="subsection">
                        <div class="subsection-title">æ•°æ®è¦ç´ </div>
                        <div id="sh-data-container">
                            <!-- æ•°æ®é¡¹å°†åŠ¨æ€æ·»åŠ  -->
                        </div>
                        <button class="add-btn" onclick="addDataItem('sh')">+ æ·»åŠ æ•°æ®</button>
                    </div>
                    
                    <!-- åŸºåº§æ¨¡å‹ -->
                    <div class="subsection">
                        <div class="subsection-title">åŸºåº§æ¨¡å‹</div>
                        <div id="sh-model-container">
                            <!-- æ¨¡å‹é¡¹å°†åŠ¨æ€æ·»åŠ  -->
                        </div>
                        <button class="add-btn" onclick="addModelItem('sh')">+ æ·»åŠ æ¨¡å‹</button>
                    </div>
                    
                    <!-- èƒ½åŠ›æ¨¡å‹ -->
                    <div class="subsection">
                        <div class="subsection-title">èƒ½åŠ›æ¨¡å‹</div>
                        <div id="sh-capability-container">
                            <!-- èƒ½åŠ›æ¨¡å‹é¡¹å°†åŠ¨æ€æ·»åŠ  -->
                        </div>
                        <button class="add-btn" onclick="addCapabilityItem('sh')">+ æ·»åŠ èƒ½åŠ›æ¨¡å‹</button>
                    </div>
                </div>
                
                <!-- çœ¼ç›éƒ¨åˆ† -->
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ‘ï¸</div>
                        çœ¼ç›ï¼ˆæ„ŸçŸ¥ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ„ŸçŸ¥ç¡¬ä»¶</div>
                        <textarea placeholder="è¯·è¾“å…¥æ„ŸçŸ¥ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="sh-perception"></textarea>
                    </div>
                </div>
                
                <!-- èº«ä½“éƒ¨åˆ† -->
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ¤–</div>
                        èº«ä½“ï¼ˆäº§å“ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">äº§å“åˆ—è¡¨</div>
                        <div id="sh-product-container">
                            <!-- äº§å“é¡¹å°†åŠ¨æ€æ·»åŠ  -->
                        </div>
                        <button class="add-btn" onclick="addProductItem('sh')">+ æ·»åŠ äº§å“</button>
                    </div>
                </div>
                
                <button class="save-btn" onclick="saveProject('sh')">ğŸ’¾ ä¿å­˜ç¡…åŸºäººåŠ›</button>
            </div>
            
            <!-- ç¡…åŸºåŒäº‹ -->
            <div id="silicon-colleague" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #4c1d95;">ç¡…åŸºåŒäº‹</h2>
                
                <div class="flow-diagram">
                    <span class="flow-step">æ•°æ®è¦ç´ </span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">åŸºåº§æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">èƒ½åŠ›æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">äº§å“è¾“å‡º</span>
                    <br>
                    <span style="font-size: 12px; opacity: 0.8;">æ”¯æŒçµæ´»è¿æ¥:æ•°æ®å¯ç›´æ¥åˆ°èƒ½åŠ›æ¨¡å‹,åŸºåº§æ¨¡å‹å¯ç›´æ¥åˆ°äº§å“</span>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ’—</div>
                        å¿ƒè„ï¼ˆç®—åŠ›ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">è®­ç»ƒç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="sc-training-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ¨ç†ç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="sc-inference-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">ç¡¬ä»¶è½½ä½“</div>
                        <textarea placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="sc-hardware"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ§ </div>
                        å¤§è„‘
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ•°æ®è¦ç´ </div>
                        <div id="sc-data-container"></div>
                        <button class="add-btn" onclick="addDataItem('sc')">+ æ·»åŠ æ•°æ®</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">åŸºåº§æ¨¡å‹</div>
                        <div id="sc-model-container"></div>
                        <button class="add-btn" onclick="addModelItem('sc')">+ æ·»åŠ æ¨¡å‹</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">èƒ½åŠ›æ¨¡å‹</div>
                        <div id="sc-capability-container"></div>
                        <button class="add-btn" onclick="addCapabilityItem('sc')">+ æ·»åŠ èƒ½åŠ›æ¨¡å‹</button>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ‘ï¸</div>
                        çœ¼ç›ï¼ˆæ„ŸçŸ¥ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ„ŸçŸ¥ç¡¬ä»¶</div>
                        <textarea placeholder="è¯·è¾“å…¥æ„ŸçŸ¥ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="sc-perception"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ¤–</div>
                        èº«ä½“ï¼ˆäº§å“ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">äº§å“åˆ—è¡¨</div>
                        <div id="sc-product-container"></div>
                        <button class="add-btn" onclick="addProductItem('sc')">+ æ·»åŠ äº§å“</button>
                    </div>
                </div>
                
                <button class="save-btn" onclick="saveProject('sc')">ğŸ’¾ ä¿å­˜ç¡…åŸºåŒäº‹</button>
            </div>
            
            <!-- åŸºåº§æ¨¡å‹ -->
            <div id="base-model" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #4c1d95;">åŸºåº§æ¨¡å‹</h2>
                
                <div class="flow-diagram">
                    <span class="flow-step">æ•°æ®è¦ç´ </span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">åŸºåº§æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">èƒ½åŠ›æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">äº§å“è¾“å‡º</span>
                    <br>
                    <span style="font-size: 12px; opacity: 0.8;">æ”¯æŒçµæ´»è¿æ¥:æ•°æ®å¯ç›´æ¥åˆ°èƒ½åŠ›æ¨¡å‹,åŸºåº§æ¨¡å‹å¯ç›´æ¥åˆ°äº§å“</span>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ’—</div>
                        å¿ƒè„ï¼ˆç®—åŠ›ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">è®­ç»ƒç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="bm-training-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ¨ç†ç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="bm-inference-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">ç¡¬ä»¶è½½ä½“</div>
                        <textarea placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="bm-hardware"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ§ </div>
                        å¤§è„‘
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ•°æ®è¦ç´ </div>
                        <div id="bm-data-container"></div>
                        <button class="add-btn" onclick="addDataItem('bm')">+ æ·»åŠ æ•°æ®</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">åŸºåº§æ¨¡å‹</div>
                        <div id="bm-model-container"></div>
                        <button class="add-btn" onclick="addModelItem('bm')">+ æ·»åŠ æ¨¡å‹</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">èƒ½åŠ›æ¨¡å‹</div>
                        <div id="bm-capability-container"></div>
                        <button class="add-btn" onclick="addCapabilityItem('bm')">+ æ·»åŠ èƒ½åŠ›æ¨¡å‹</button>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ‘ï¸</div>
                        çœ¼ç›ï¼ˆæ„ŸçŸ¥ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ„ŸçŸ¥ç¡¬ä»¶</div>
                        <textarea placeholder="è¯·è¾“å…¥æ„ŸçŸ¥ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="bm-perception"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ¤–</div>
                        èº«ä½“ï¼ˆäº§å“ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">äº§å“åˆ—è¡¨</div>
                        <div id="bm-product-container"></div>
                        <button class="add-btn" onclick="addProductItem('bm')">+ æ·»åŠ äº§å“</button>
                    </div>
                </div>
                
                <button class="save-btn" onclick="saveProject('bm')">ğŸ’¾ ä¿å­˜åŸºåº§æ¨¡å‹</button>
            </div>
            
            <!-- ç©ºé—´æœºå™¨äºº -->
            <div id="space-robot" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #4c1d95;">ç©ºé—´æœºå™¨äºº</h2>
                
                <div class="flow-diagram">
                    <span class="flow-step">æ•°æ®è¦ç´ </span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">åŸºåº§æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">èƒ½åŠ›æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">äº§å“è¾“å‡º</span>
                    <br>
                    <span style="font-size: 12px; opacity: 0.8;">æ”¯æŒçµæ´»è¿æ¥:æ•°æ®å¯ç›´æ¥åˆ°èƒ½åŠ›æ¨¡å‹,åŸºåº§æ¨¡å‹å¯ç›´æ¥åˆ°äº§å“</span>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ’—</div>
                        å¿ƒè„ï¼ˆç®—åŠ›ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">è®­ç»ƒç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="sr-training-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ¨ç†ç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="sr-inference-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">ç¡¬ä»¶è½½ä½“</div>
                        <textarea placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="sr-hardware"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ§ </div>
                        å¤§è„‘
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ•°æ®è¦ç´ </div>
                        <div id="sr-data-container"></div>
                        <button class="add-btn" onclick="addDataItem('sr')">+ æ·»åŠ æ•°æ®</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">åŸºåº§æ¨¡å‹</div>
                        <div id="sr-model-container"></div>
                        <button class="add-btn" onclick="addModelItem('sr')">+ æ·»åŠ æ¨¡å‹</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">èƒ½åŠ›æ¨¡å‹</div>
                        <div id="sr-capability-container"></div>
                        <button class="add-btn" onclick="addCapabilityItem('sr')">+ æ·»åŠ èƒ½åŠ›æ¨¡å‹</button>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ‘ï¸</div>
                        çœ¼ç›ï¼ˆæ„ŸçŸ¥ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ„ŸçŸ¥ç¡¬ä»¶</div>
                        <textarea placeholder="è¯·è¾“å…¥æ„ŸçŸ¥ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="sr-perception"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ¤–</div>
                        èº«ä½“ï¼ˆäº§å“ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">äº§å“åˆ—è¡¨</div>
                        <div id="sr-product-container"></div>
                        <button class="add-btn" onclick="addProductItem('sr')">+ æ·»åŠ äº§å“</button>
                    </div>
                </div>
                
                <button class="save-btn" onclick="saveProject('sr')">ğŸ’¾ ä¿å­˜ç©ºé—´æœºå™¨äºº</button>
            </div>
            
            <!-- ç©¿æˆ´æœºå™¨äºº -->
            <div id="wearable-robot" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #4c1d95;">ç©¿æˆ´æœºå™¨äºº</h2>
                
                <div class="flow-diagram">
                    <span class="flow-step">æ•°æ®è¦ç´ </span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">åŸºåº§æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">èƒ½åŠ›æ¨¡å‹</span>
                    <span class="flow-arrow">â†’</span>
                    <span class="flow-step">äº§å“è¾“å‡º</span>
                    <br>
                    <span style="font-size: 12px; opacity: 0.8;">æ”¯æŒçµæ´»è¿æ¥:æ•°æ®å¯ç›´æ¥åˆ°èƒ½åŠ›æ¨¡å‹,åŸºåº§æ¨¡å‹å¯ç›´æ¥åˆ°äº§å“</span>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ’—</div>
                        å¿ƒè„ï¼ˆç®—åŠ›ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">è®­ç»ƒç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="wr-training-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ¨ç†ç®—åŠ›</div>
                        <input type="text" placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„å¡æ•°é‡" id="wr-inference-compute">
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">ç¡¬ä»¶è½½ä½“</div>
                        <textarea placeholder="è¯·è¾“å…¥ä½¿ç”¨çš„ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="wr-hardware"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ§ </div>
                        å¤§è„‘
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ•°æ®è¦ç´ </div>
                        <div id="wr-data-container"></div>
                        <button class="add-btn" onclick="addDataItem('wr')">+ æ·»åŠ æ•°æ®</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">åŸºåº§æ¨¡å‹</div>
                        <div id="wr-model-container"></div>
                        <button class="add-btn" onclick="addModelItem('wr')">+ æ·»åŠ æ¨¡å‹</button>
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">èƒ½åŠ›æ¨¡å‹</div>
                        <div id="wr-capability-container"></div>
                        <button class="add-btn" onclick="addCapabilityItem('wr')">+ æ·»åŠ èƒ½åŠ›æ¨¡å‹</button>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ‘ï¸</div>
                        çœ¼ç›ï¼ˆæ„ŸçŸ¥ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">æ„ŸçŸ¥ç¡¬ä»¶</div>
                        <textarea placeholder="è¯·è¾“å…¥æ„ŸçŸ¥ç¡¬ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª" id="wr-perception"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <div class="section-icon">ğŸ¤–</div>
                        èº«ä½“ï¼ˆäº§å“ï¼‰
                    </div>
                    <div class="subsection">
                        <div class="subsection-title">äº§å“åˆ—è¡¨</div>
                        <div id="wr-product-container"></div>
                        <button class="add-btn" onclick="addProductItem('wr')">+ æ·»åŠ äº§å“</button>
                    </div>
                </div>
                
                <button class="save-btn" onclick="saveProject('wr')">ğŸ’¾ ä¿å­˜ç©¿æˆ´æœºå™¨äºº</button>
            </div>
            
            <!-- äº§å“æ±‡æ€» -->
            <div id="summary" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #4c1d95;">ğŸ“Š äº§å“è§†è§’æ±‡æ€»</h2>
                <p style="color: #666; margin-bottom: 20px;">ä»¥äº§å“ä¸ºä¸­å¿ƒï¼Œè¿½æº¯æ¯ä¸ªäº§å“çš„æŠ€æœ¯æ¥æºå’Œæ•°æ®è·¯å¾„</p>
                <div id="summary-content"></div>
            </div>
        </div>
    </div>

    <script>
        
    // ==================== Firebaseé…ç½®å’Œåˆå§‹åŒ– ====================
    const firebaseConfig = {
        apiKey: "AIzaSyB4w5VAbNyrhRtr0yeCLJy3TNMHWaBKghU",
        authDomain: "projectmanagment-2bc2d.firebaseapp.com",
        projectId: "projectmanagment-2bc2d",
        storageBucket: "projectmanagment-2bc2d.firebasestorage.app",
        messagingSenderId: "1002641026413",
        appId: "1:1002641026413:web:1f20194b84b5fba15f7e64",
        measurementId: "G-58XBNQNX8X"
    };

    // åˆå§‹åŒ–Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // æ£€æŸ¥Firebaseæ˜¯å¦æ­£ç¡®åŠ è½½
    if (typeof firebase === 'undefined') {
        console.error('FirebaseæœªåŠ è½½!');
        alert('FirebaseåŠ è½½å¤±è´¥,è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
    } else {
        console.log('Firebaseå·²åŠ è½½');
        console.log('Auth:', auth);
        console.log('Firestore:', db);
    }
    
    let currentUser = null;
    let saveTimeout = null;

    // ==================== è®¤è¯çŠ¶æ€ç›‘å¬ ====================
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            document.getElementById('auth-overlay').classList.add('hidden');
            document.getElementById('user-bar').classList.remove('hidden');
            document.getElementById('user-email-display').textContent = user.email;
            
            // åŠ è½½ç”¨æˆ·æ•°æ®
            loadDataFromFirebase();
        } else {
            currentUser = null;
            document.getElementById('auth-overlay').classList.remove('hidden');
            document.getElementById('user-bar').classList.add('hidden');
        }
    });

    // ==================== è®¤è¯åŠŸèƒ½ ====================
    
    function showAuthError(message) {
        const errorDiv = document.getElementById('auth-error');
        errorDiv.textContent = message;
        errorDiv.classList.remove('hidden');
        setTimeout(() => {
            errorDiv.classList.add('hidden');
        }, 5000);
    }

    function showLogin() {
        document.getElementById('login-form').classList.remove('hidden');
        document.getElementById('register-form').classList.add('hidden');
        document.getElementById('auth-error').classList.add('hidden');
    }

    function showRegister() {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('register-form').classList.remove('hidden');
        document.getElementById('auth-error').classList.add('hidden');
    }

    async function handleLogin() {
        console.log('handleLogin è¢«è°ƒç”¨');
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;
        
        if (!email || !password) {
            showAuthError('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ');
            return;
        }
        
        try {
            await auth.signInWithEmailAndPassword(email, password);
        } catch (error) {
            console.error('ç™»å½•é”™è¯¯:', error);
            if (error.code === 'auth/user-not-found') {
                showAuthError('ç”¨æˆ·ä¸å­˜åœ¨');
            } else if (error.code === 'auth/wrong-password') {
                showAuthError('å¯†ç é”™è¯¯');
            } else if (error.code === 'auth/invalid-email') {
                showAuthError('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');
            } else {
                showAuthError('ç™»å½•å¤±è´¥: ' + error.message);
            }
        }
    }

    async function handleRegister() {
        console.log('handleRegister è¢«è°ƒç”¨');
        const email = document.getElementById('register-email').value.trim();
        const password = document.getElementById('register-password').value;
        const confirm = document.getElementById('register-password-confirm').value;
        
        if (!email || !password || !confirm) {
            showAuthError('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
            return;
        }
        
        if (password !== confirm) {
            showAuthError('ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´');
            return;
        }
        
        if (password.length < 6) {
            showAuthError('å¯†ç è‡³å°‘éœ€è¦6ä½');
            return;
        }
        
        try {
            await auth.createUserWithEmailAndPassword(email, password);
            showAuthError('æ³¨å†ŒæˆåŠŸ!æ­£åœ¨ç™»å½•...');
            setTimeout(() => {
                document.getElementById('auth-error').classList.add('hidden');
            }, 2000);
        } catch (error) {
            console.error('æ³¨å†Œé”™è¯¯:', error);
            if (error.code === 'auth/email-already-in-use') {
                showAuthError('è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ');
            } else if (error.code === 'auth/invalid-email') {
                showAuthError('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');
            } else if (error.code === 'auth/weak-password') {
                showAuthError('å¯†ç å¼ºåº¦ä¸å¤Ÿ');
            } else {
                showAuthError('æ³¨å†Œå¤±è´¥: ' + error.message);
            }
        }
    }

    async function handleGoogleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            await auth.signInWithPopup(provider);
        } catch (error) {
            console.error('Googleç™»å½•é”™è¯¯:', error);
            if (error.code === 'auth/popup-closed-by-user') {
                showAuthError('ç™»å½•çª—å£å·²å…³é—­');
            } else {
                showAuthError('Googleç™»å½•å¤±è´¥: ' + error.message);
            }
        }
    }

    
    // ç¡®ä¿å‡½æ•°å…¨å±€å¯ç”¨
    window.handleLogin = handleLogin;
    window.handleRegister = handleRegister;
    window.handleGoogleLogin = handleGoogleLogin;
    window.handleLogout = handleLogout;
    window.showLogin = showLogin;
    window.showRegister = showRegister;

    async function handleLogout() {
        if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—?')) {
            try {
                await auth.signOut();
            } catch (error) {
                console.error('é€€å‡ºé”™è¯¯:', error);
                alert('é€€å‡ºå¤±è´¥');
            }
        }
    }

    // ==================== æ•°æ®åŒæ­¥åŠŸèƒ½ ====================
    
    function updateSyncStatus(status, message) {
        const statusEl = document.getElementById('sync-status');
        statusEl.className = 'sync-status ' + status;
        statusEl.textContent = message;
    }

    async function loadDataFromFirebase() {
        if (!currentUser) return;
        
        updateSyncStatus('syncing', 'åŠ è½½ä¸­...');
        
        try {
            const doc = await db.collection('users').doc(currentUser.uid).get();
            
            if (doc.exists) {
                const data = doc.data();
                if (data.projects) {
                    projectData = data.projects;
                    
                    // é‡æ–°åŠ è½½æ‰€æœ‰é¡¹ç›®åˆ°ç•Œé¢
                    ['sh', 'sc', 'bm', 'sr', 'wr'].forEach(project => {
                        loadProjectToUI(project);
                    });
                    
                    console.log('æ•°æ®åŠ è½½æˆåŠŸ');
                }
            } else {
                console.log('æ–°ç”¨æˆ·,æ— å†å²æ•°æ®');
            }
            
            updateSyncStatus('synced', 'å·²åŒæ­¥ âœ“');
        } catch (error) {
            console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            updateSyncStatus('error', 'åŠ è½½å¤±è´¥ âœ—');
        }
    }

    async function saveToFirebase() {
        if (!currentUser) return;
        
        updateSyncStatus('syncing', 'ä¿å­˜ä¸­...');
        
        try {
            await db.collection('users').doc(currentUser.uid).set({
                projects: projectData,
                lastUpdate: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
            
            updateSyncStatus('synced', 'å·²åŒæ­¥ âœ“');
            console.log('æ•°æ®ä¿å­˜æˆåŠŸ');
        } catch (error) {
            console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
            updateSyncStatus('error', 'åŒæ­¥å¤±è´¥ âœ—');
        }
    }

    // é˜²æŠ–ä¿å­˜ - é¿å…é¢‘ç¹ä¿å­˜
    function debouncedSave() {
        if (saveTimeout) clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
            saveToFirebase();
        }, 1000); // 1ç§’åä¿å­˜
    }

    // ==================== åŠ è½½é¡¹ç›®æ•°æ®åˆ°UI ====================
    
    function loadProjectToUI(project) {
        const data = projectData[project];
        
        // æ¸…ç©ºç°æœ‰å®¹å™¨
        const dataContainer = document.getElementById(`${project}-data-container`);
        const modelContainer = document.getElementById(`${project}-model-container`);
        const capabilityContainer = document.getElementById(`${project}-capability-container`);
        const productContainer = document.getElementById(`${project}-product-container`);
        
        if (dataContainer) dataContainer.innerHTML = '';
        if (modelContainer) modelContainer.innerHTML = '';
        if (capabilityContainer) capabilityContainer.innerHTML = '';
        if (productContainer) productContainer.innerHTML = '';
        
        // åŠ è½½åŸºæœ¬å­—æ®µ
        const trainingInput = document.getElementById(`${project}-training-compute`);
        const inferenceInput = document.getElementById(`${project}-inference-compute`);
        const hardwareInput = document.getElementById(`${project}-hardware`);
        const perceptionInput = document.getElementById(`${project}-perception`);
        
        if (trainingInput && data.trainingCompute) trainingInput.value = data.trainingCompute;
        if (inferenceInput && data.inferenceCompute) inferenceInput.value = data.inferenceCompute;
        if (hardwareInput && data.hardware) hardwareInput.value = data.hardware;
        if (perceptionInput && data.perception) perceptionInput.value = data.perception;
        
        // é‡æ–°åˆ›å»ºæ‰€æœ‰é¡¹ç›®
        if (data.data) {
            data.data.forEach((item, index) => {
                const html = createDataItemHTML(project, item, index + 1);
                if (dataContainer) dataContainer.insertAdjacentHTML('beforeend', html);
            });
        }
        
        if (data.models) {
            data.models.forEach((item, index) => {
                const html = createModelItemHTML(project, item, index + 1);
                if (modelContainer) modelContainer.insertAdjacentHTML('beforeend', html);
            });
        }
        
        if (data.capabilities) {
            data.capabilities.forEach((item, index) => {
                const html = createCapabilityItemHTML(project, item, index + 1);
                if (capabilityContainer) capabilityContainer.insertAdjacentHTML('beforeend', html);
            });
        }
        
        if (data.products) {
            data.products.forEach((item, index) => {
                const html = createProductItemHTML(project, item, index + 1);
                if (productContainer) productContainer.insertAdjacentHTML('beforeend', html);
            });
        }
        
        // æ›´æ–°æ‰€æœ‰é€‰æ‹©å™¨
        updateAllSelectors(project);
    }

// å…¨å±€æ•°æ®å­˜å‚¨
        let projectData = {
            sh: { data: [], models: [], capabilities: [], products: [] },
            sc: { data: [], models: [], capabilities: [], products: [] },
            bm: { data: [], models: [], capabilities: [], products: [] },
            sr: { data: [], models: [], capabilities: [], products: [] },
            wr: { data: [], models: [], capabilities: [], products: [] }
        };
        
        // äº§å“é€‰é¡¹
        const productOptions = [
            { value: 'autonomous-driving', label: 'ğŸš— è‡ªåŠ¨é©¾é©¶' },
            { value: 'smart-cabin', label: 'ğŸ  æ™ºèƒ½åº§èˆ±' },
            { value: 'wearable-robot', label: 'ğŸ¦¾ ç©¿æˆ´æœºå™¨äºº' },
            { value: 'silicon-colleague', label: 'ğŸ‘” ç¡…åŸºåŒäº‹' }
        ];
        
        // é¡¹ç›®åç§°æ˜ å°„
        const projectNames = {
            sh: 'ç¡…åŸºäººåŠ›',
            sc: 'ç¡…åŸºåŒäº‹',
            bm: 'åŸºåº§æ¨¡å‹',
            sr: 'ç©ºé—´æœºå™¨äºº',
            wr: 'ç©¿æˆ´æœºå™¨äºº'
        };
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ›´æ–°å†…å®¹åŒºåŸŸ
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            // å¦‚æœæ˜¯æ±‡æ€»é¡µé¢ï¼Œç”Ÿæˆæ±‡æ€»
            if (tabId === 'summary') {
                generateSummary();
            }
        }
        
        // æ·»åŠ æ•°æ®é¡¹
        function addDataItem(project) {
            const container = document.getElementById(`${project}-data-container`);
            const index = projectData[project].data.length + 1;
            
            const dataItem = {
                id: `${project}-data-${index}`,
                name: '',
                source: 'internal',
                volume: '',
                toModels: [],
                toCapabilities: []
            };
            
            projectData[project].data.push(dataItem);
            
            const html = `
                <div class="data-item" data-id="${dataItem.id}">
                    <div class="item-header">
                        <span class="item-title">æ•°æ® #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'data', '${dataItem.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>æ•°æ®åç§°ï¼š</label>
                        <input type="text" placeholder="è¾“å…¥æ•°æ®åç§°" onchange="updateDataField('${project}', '${dataItem.id}', 'name', this.value)">
                    </div>
                    <div class="input-group">
                        <label>æ•°æ®æ¥æºï¼š</label>
                        <select onchange="updateDataField('${project}', '${dataItem.id}', 'source', this.value)">
                            <option value="internal">å†…éƒ¨</option>
                            <option value="external">å¤–éƒ¨</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>æ•°æ®é‡ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼š100TB" onchange="updateDataField('${project}', '${dataItem.id}', 'volume', this.value)">
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">è¾“å…¥åˆ°åŸºåº§æ¨¡å‹ï¼š</span>
                        <select multiple id="${dataItem.id}-to-models" onchange="updateDataRelation('${project}', '${dataItem.id}')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥è¾“å‡ºåˆ°èƒ½åŠ›æ¨¡å‹ï¼š</span>
                        <select multiple id="${dataItem.id}-to-capabilities" onchange="updateDataRelation('${project}', '${dataItem.id}', 'toCapabilities')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', html);
            updateAllSelectors(project);
        }
        
        // æ·»åŠ åŸºåº§æ¨¡å‹é¡¹
        function addModelItem(project) {
            const container = document.getElementById(`${project}-model-container`);
            const index = projectData[project].models.length + 1;
            
            const modelItem = {
                id: `${project}-model-${index}`,
                name: '',
                params: '',
                version: '',
                fromData: [],
                toCapabilities: [],
                toProducts: []
            };
            
            projectData[project].models.push(modelItem);
            
            const html = `
                <div class="model-item" data-id="${modelItem.id}">
                    <div class="item-header">
                        <span class="item-title">åŸºåº§æ¨¡å‹ #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'models', '${modelItem.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>æ¨¡å‹åç§°ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼šGPT-4" onchange="updateModelField('${project}', '${modelItem.id}', 'name', this.value)">
                    </div>
                    <div class="input-group">
                        <label>å‚æ•°è§„æ¨¡ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼š175B" onchange="updateModelField('${project}', '${modelItem.id}', 'params', this.value)">
                    </div>
                    <div class="input-group">
                        <label>ç‰ˆæœ¬å·ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼šv2.0" onchange="updateModelField('${project}', '${modelItem.id}', 'version', this.value)">
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">æ¥è‡ªæ•°æ®ï¼š</span>
                        <select multiple id="${modelItem.id}-from-data" onchange="updateModelRelation('${project}', '${modelItem.id}', 'from')">
                            <option value="none">æ— </option>
                        </select>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">è¾“å‡ºåˆ°èƒ½åŠ›æ¨¡å‹ï¼š</span>
                        <select multiple id="${modelItem.id}-to-capabilities" onchange="updateModelRelation('${project}', '${modelItem.id}', 'toCapabilities')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥è¾“å‡ºåˆ°äº§å“ï¼š</span>
                        <select multiple id="${modelItem.id}-to-products" onchange="updateModelRelation('${project}', '${modelItem.id}', 'toProducts')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', html);
            updateAllSelectors(project);
        }
        
        // æ·»åŠ èƒ½åŠ›æ¨¡å‹é¡¹
        function addCapabilityItem(project) {
            const container = document.getElementById(`${project}-capability-container`);
            const index = projectData[project].capabilities.length + 1;
            
            const capItem = {
                id: `${project}-capability-${index}`,
                name: '',
                description: '',
                fromModels: [],
                fromData: [],
                toProducts: []
            };
            
            projectData[project].capabilities.push(capItem);
            
            const html = `
                <div class="capability-item" data-id="${capItem.id}">
                    <div class="item-header">
                        <span class="item-title">èƒ½åŠ›æ¨¡å‹ #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'capabilities', '${capItem.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>èƒ½åŠ›æ¨¡å‹åç§°ï¼š</label>
                        <input type="text" placeholder="è¾“å…¥èƒ½åŠ›æ¨¡å‹åç§°" onchange="updateCapabilityField('${project}', '${capItem.id}', 'name', this.value)">
                    </div>
                    <div class="input-group">
                        <label>æè¿°ï¼š</label>
                        <textarea placeholder="æè¿°è¯¥èƒ½åŠ›æ¨¡å‹çš„åŠŸèƒ½å’Œç‰¹ç‚¹" onchange="updateCapabilityField('${project}', '${capItem.id}', 'description', this.value)"></textarea>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">æ¥è‡ªåŸºåº§æ¨¡å‹ï¼š</span>
                        <select multiple id="${capItem.id}-from-models" onchange="updateCapabilityRelation('${project}', '${capItem.id}', 'from')">
                            <option value="none">æ— </option>
                        </select>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥æ¥è‡ªæ•°æ®ï¼š</span>
                        <select multiple id="${capItem.id}-from-data" onchange="updateCapabilityRelation('${project}', '${capItem.id}', 'fromData')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">è¾“å‡ºåˆ°äº§å“ï¼š</span>
                        <select multiple id="${capItem.id}-to-products" onchange="updateCapabilityRelation('${project}', '${capItem.id}', 'to')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', html);
            updateAllSelectors(project);
        }
        
        // æ·»åŠ äº§å“é¡¹
        function addProductItem(project) {
            const container = document.getElementById(`${project}-product-container`);
            const index = projectData[project].products.length + 1;
            
            const productItem = {
                id: `${project}-product-${index}`,
                type: '',
                description: '',
                fromCapabilities: [],
                fromModels: []
            };
            
            projectData[project].products.push(productItem);
            
            let optionsHtml = '<option value="">è¯·é€‰æ‹©äº§å“</option>';
            productOptions.forEach(opt => {
                optionsHtml += `<option value="${opt.value}">${opt.label}</option>`;
            });
            
            const html = `
                <div class="product-item" data-id="${productItem.id}">
                    <div class="item-header">
                        <span class="item-title">äº§å“ #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'products', '${productItem.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>é€‰æ‹©äº§å“ï¼š</label>
                        <select onchange="updateProductField('${project}', '${productItem.id}', 'type', this.value)">
                            ${optionsHtml}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>äº§å“æè¿°ï¼š</label>
                        <textarea placeholder="æè¿°äº§å“ç‰¹ç‚¹" onchange="updateProductField('${project}', '${productItem.id}', 'description', this.value)"></textarea>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">æ¥æºäºèƒ½åŠ›æ¨¡å‹ï¼š</span>
                        <select multiple id="${productItem.id}-from-capabilities" onchange="updateProductRelation('${project}', '${productItem.id}', 'fromCapabilities')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥æ¥æºäºåŸºåº§æ¨¡å‹ï¼š</span>
                        <select multiple id="${productItem.id}-from-models" onchange="updateProductRelation('${project}', '${productItem.id}', 'fromModels')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', html);
            updateAllSelectors(project);
        }
        
        // æ›´æ–°æ•°æ®å­—æ®µ
        function updateDataField(project, id, field, value) {
            const item = projectData[project].data.find(d => d.id === id);
            if (item) item[field] = value;
        
        debouncedSave();
    }
        
        // æ›´æ–°æ¨¡å‹å­—æ®µ
        function updateModelField(project, id, field, value) {
            const item = projectData[project].models.find(m => m.id === id);
            if (item) item[field] = value;
        
        debouncedSave();
    }
        
        // æ›´æ–°èƒ½åŠ›æ¨¡å‹å­—æ®µ
        function updateCapabilityField(project, id, field, value) {
            const item = projectData[project].capabilities.find(c => c.id === id);
            if (item) item[field] = value;
        
        debouncedSave();
    }
        
        // æ›´æ–°äº§å“å­—æ®µ
        function updateProductField(project, id, field, value) {
            const item = projectData[project].products.find(p => p.id === id);
            if (item) item[field] = value;
        
        debouncedSave();
    }
        
        // æ›´æ–°æ•°æ®å…³è”
        function updateDataRelation(project, id) {
            const item = projectData[project].data.find(d => d.id === id);
            const select = document.getElementById(`${id}-to-models`);
            const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
            if (item) item.toModels = selected;
        }
        
        // æ›´æ–°æ¨¡å‹å…³è”
        function updateModelRelation(project, id, field) {
            const item = projectData[project].models.find(m => m.id === id);
            if (!item) return;
            
            if (field === 'fromData') {
                const select = document.getElementById(`${id}-from-data`);
                const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
                item.fromData = selected;
            } else if (field === 'toCapabilities') {
                const select = document.getElementById(`${id}-to-capabilities`);
                const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
                item.toCapabilities = selected;
            } else if (field === 'toProducts') {
                const select = document.getElementById(`${id}-to-products`);
                const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
                item.toProducts = selected;
            }
        }
        
        // æ›´æ–°èƒ½åŠ›æ¨¡å‹å…³è”
        function updateCapabilityRelation(project, id, direction) {
            const item = projectData[project].capabilities.find(c => c.id === id);
            if (direction === 'from') {
                const select = document.getElementById(`${id}-from-models`);
                const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
                if (item) item.fromModels = selected;
            } else {
                const select = document.getElementById(`${id}-to-products`);
                const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
                if (item) item.toProducts = selected;
            }
        }
        
        // æ›´æ–°äº§å“å…³è”
        function updateProductRelation(project, id, field) {
            const item = projectData[project].products.find(p => p.id === id);
            if (!item) return;
            
            if (field === 'fromCapabilities') {
                const select = document.getElementById(`${id}-from-capabilities`);
                const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
                item.fromCapabilities = selected;
            } else if (field === 'fromModels') {
                const select = document.getElementById(`${id}-from-models`);
                const selected = Array.from(select.selectedOptions).map(opt => opt.value).filter(v => v !== 'none');
                item.fromModels = selected;
            }
        }
        
        // æ›´æ–°æ‰€æœ‰é€‰æ‹©å™¨
        function updateAllSelectors(project) {
            setTimeout(() => {
                // æ›´æ–°æ•°æ®â†’æ¨¡å‹é€‰æ‹©å™¨
                projectData[project].data.forEach(dataItem => {
                    const select = document.getElementById(`${dataItem.id}-to-models`);
                    if (select) {
                        select.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model.id;
                            option.textContent = model.name || `åŸºåº§æ¨¡å‹ #${model.id.split('-').pop()}`;
                            if (dataItem.toModels.includes(model.id)) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        });
                    }
                });
                
                // æ›´æ–°æ¨¡å‹é€‰æ‹©å™¨
                projectData[project].models.forEach(model => {
                    // æ¥è‡ªæ•°æ®
                    const fromSelect = document.getElementById(`${model.id}-from-data`);
                    if (fromSelect) {
                        fromSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].data.forEach(dataItem => {
                            const option = document.createElement('option');
                            option.value = dataItem.id;
                            option.textContent = dataItem.name || `æ•°æ® #${dataItem.id.split('-').pop()}`;
                            if (model.fromData.includes(dataItem.id)) {
                                option.selected = true;
                            }
                            fromSelect.appendChild(option);
                        });
                    }
                    
                    // åˆ°èƒ½åŠ›æ¨¡å‹
                    const toCapSelect = document.getElementById(`${model.id}-to-capabilities`);
                    if (toCapSelect) {
                        toCapSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].capabilities.forEach(cap => {
                            const option = document.createElement('option');
                            option.value = cap.id;
                            option.textContent = cap.name || `èƒ½åŠ›æ¨¡å‹ #${cap.id.split('-').pop()}`;
                            if (model.toCapabilities.includes(cap.id)) {
                                option.selected = true;
                            }
                            toCapSelect.appendChild(option);
                        });
                    }
                    
                    // åˆ°äº§å“
                    const toProdSelect = document.getElementById(`${model.id}-to-products`);
                    if (toProdSelect) {
                        toProdSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].products.forEach(prod => {
                            const option = document.createElement('option');
                            option.value = prod.id;
                            const productLabel = productOptions.find(p => p.value === prod.type)?.label || `äº§å“ #${prod.id.split('-').pop()}`;
                            option.textContent = productLabel;
                            if (model.toProducts && model.toProducts.includes(prod.id)) {
                                option.selected = true;
                            }
                            toProdSelect.appendChild(option);
                        });
                    }
                });
                
                // æ›´æ–°èƒ½åŠ›æ¨¡å‹é€‰æ‹©å™¨
                projectData[project].capabilities.forEach(cap => {
                    // æ¥è‡ªåŸºåº§æ¨¡å‹
                    const fromSelect = document.getElementById(`${cap.id}
                    
                    // æ¥è‡ªæ•°æ®
                    const fromDataSelect = document.getElementById(`${cap.id}-from-data`);
                    if (fromDataSelect) {
                        fromDataSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].data.forEach(dataItem => {
                            const option = document.createElement('option');
                            option.value = dataItem.id;
                            option.textContent = dataItem.name || `æ•°æ® #${dataItem.id.split('-').pop()}`;
                            if (cap.fromData && cap.fromData.includes(dataItem.id)) {
                                option.selected = true;
                            }
                            fromDataSelect.appendChild(option);
                        });
                    }-from-models`);
                    if (fromSelect) {
                        fromSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model.id;
                            option.textContent = model.name || `åŸºåº§æ¨¡å‹ #${model.id.split('-').pop()}`;
                            if (cap.fromModels.includes(model.id)) {
                                option.selected = true;
                            }
                            fromSelect.appendChild(option);
                        });
                    }
                    
                    // åˆ°äº§å“
                    const toSelect = document.getElementById(`${cap.id}-to-products`);
                    if (toSelect) {
                        toSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].products.forEach(prod => {
                            const option = document.createElement('option');
                            option.value = prod.id;
                            const productLabel = productOptions.find(p => p.value === prod.type)?.label || `äº§å“ #${prod.id.split('-').pop()}`;
                            option.textContent = productLabel;
                            if (cap.toProducts.includes(prod.id)) {
                                option.selected = true;
                            }
                            toSelect.appendChild(option);
                        });
                    }
                });
                
                // æ›´æ–°äº§å“é€‰æ‹©å™¨
                projectData[project].products.forEach(prod => {
                    // æ¥è‡ªèƒ½åŠ›æ¨¡å‹
                    const fromCapSelect = document.getElementById(`${prod.id}-from-capabilities`);
                    if (fromCapSelect) {
                        fromCapSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].capabilities.forEach(cap => {
                            const option = document.createElement('option');
                            option.value = cap.id;
                            option.textContent = cap.name || `èƒ½åŠ›æ¨¡å‹ #${cap.id.split('-').pop()}`;
                            if (prod.fromCapabilities.includes(cap.id)) {
                                option.selected = true;
                            }
                            fromCapSelect.appendChild(option);
                        });
                    }
                    
                    // æ¥è‡ªåŸºåº§æ¨¡å‹
                    const fromModelSelect = document.getElementById(`${prod.id}-from-models`);
                    if (fromModelSelect) {
                        fromModelSelect.innerHTML = '<option value="none">æ— </option>';
                        projectData[project].models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model.id;
                            option.textContent = model.name || `åŸºåº§æ¨¡å‹ #${model.id.split('-').pop()}`;
                            if (prod.fromModels && prod.fromModels.includes(model.id)) {
                                option.selected = true;
                            }
                            fromModelSelect.appendChild(option);
                        });
                    }
                });
            }, 100);
        }
        
        // åˆ é™¤é¡¹ç›®
        function removeItem(project, type, id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) return;
            
            // ä»æ•°æ®ä¸­åˆ é™¤
            projectData[project][type] = projectData[project][type].filter(item => item.id !== id);
            
            // ä»DOMä¸­åˆ é™¤
            const element = document.querySelector(`[data-id="${id}"]`);
            if (element) element.remove();
            
            // æ›´æ–°æ‰€æœ‰é€‰æ‹©å™¨
            updateAllSelectors(project);
        }
        
        // ä¿å­˜é¡¹ç›®
        function saveProject(project) {
            // ä¿å­˜å…¶ä»–å­—æ®µ
            const data = {
                trainingCompute: document.getElementById(`${project}-training-compute`)?.value || '',
                inferenceCompute: document.getElementById(`${project}-inference-compute`)?.value || '',
                hardware: document.getElementById(`${project}-hardware`)?.value || '',
                perception: document.getElementById(`${project}-perception`)?.value || '',
                data: projectData[project].data,
                models: projectData[project].models,
                capabilities: projectData[project].capabilities,
                products: projectData[project].products
            };
            
            localStorage.setItem(`project_${project}`, JSON.stringify(data));
            alert('ä¿å­˜æˆåŠŸï¼');
        }
        
        // åŠ è½½é¡¹ç›®æ•°æ®
        function loadProject(project) {
            const saved = localStorage.getItem(`project_${project}`);
            if (!saved) return;
            
            try {
                const data = JSON.parse(saved);
                
                // åŠ è½½åŸºæœ¬å­—æ®µ
                if (data.trainingCompute) document.getElementById(`${project}-training-compute`).value = data.trainingCompute;
                if (data.inferenceCompute) document.getElementById(`${project}-inference-compute`).value = data.inferenceCompute;
                if (data.hardware) document.getElementById(`${project}-hardware`).value = data.hardware;
                if (data.perception) document.getElementById(`${project}-perception`).value = data.perception;
                
                // æ¸…ç©ºå®¹å™¨
                projectData[project] = { data: [], models: [], capabilities: [], products: [] };
                
                // åŠ è½½æ•°æ®
                if (data.data) {
                    data.data.forEach((item, index) => {
                        projectData[project].data.push(item);
                        const container = document.getElementById(`${project}-data-container`);
                        const html = createDataItemHTML(project, item, index + 1);
                        container.insertAdjacentHTML('beforeend', html);
                    });
                }
                
                // åŠ è½½æ¨¡å‹
                if (data.models) {
                    data.models.forEach((item, index) => {
                        projectData[project].models.push(item);
                        const container = document.getElementById(`${project}-model-container`);
                        const html = createModelItemHTML(project, item, index + 1);
                        container.insertAdjacentHTML('beforeend', html);
                    });
                }
                
                // åŠ è½½èƒ½åŠ›æ¨¡å‹
                if (data.capabilities) {
                    data.capabilities.forEach((item, index) => {
                        projectData[project].capabilities.push(item);
                        const container = document.getElementById(`${project}-capability-container`);
                        const html = createCapabilityItemHTML(project, item, index + 1);
                        container.insertAdjacentHTML('beforeend', html);
                    });
                }
                
                // åŠ è½½äº§å“
                if (data.products) {
                    data.products.forEach((item, index) => {
                        projectData[project].products.push(item);
                        const container = document.getElementById(`${project}-product-container`);
                        const html = createProductItemHTML(project, item, index + 1);
                        container.insertAdjacentHTML('beforeend', html);
                    });
                }
                
                updateAllSelectors(project);
            } catch (e) {
                console.error('åŠ è½½å¤±è´¥:', e);
            }
        }
        
        // åˆ›å»ºæ•°æ®é¡¹HTML
        function createDataItemHTML(project, item, index) {
            return `
                <div class="data-item" data-id="${item.id}">
                    <div class="item-header">
                        <span class="item-title">æ•°æ® #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'data', '${item.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>æ•°æ®åç§°ï¼š</label>
                        <input type="text" placeholder="è¾“å…¥æ•°æ®åç§°" value="${item.name || ''}" onchange="updateDataField('${project}', '${item.id}', 'name', this.value)">
                    </div>
                    <div class="input-group">
                        <label>æ•°æ®æ¥æºï¼š</label>
                        <select onchange="updateDataField('${project}', '${item.id}', 'source', this.value)">
                            <option value="internal" ${item.source === 'internal' ? 'selected' : ''}>å†…éƒ¨</option>
                            <option value="external" ${item.source === 'external' ? 'selected' : ''}>å¤–éƒ¨</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>æ•°æ®é‡ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼š100TB" value="${item.volume || ''}" onchange="updateDataField('${project}', '${item.id}', 'volume', this.value)">
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">è¾“å…¥åˆ°åŸºåº§æ¨¡å‹ï¼š</span>
                        <select multiple id="${item.id}-to-models" onchange="updateDataRelation('${project}', '${item.id}')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥è¾“å‡ºåˆ°èƒ½åŠ›æ¨¡å‹ï¼š</span>
                        <select multiple id="${item.id}-to-capabilities" onchange="updateDataRelation('${project}', '${item.id}', 'toCapabilities')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
                </div>
            `;
        }
        
        // åˆ›å»ºæ¨¡å‹é¡¹HTML
        function createModelItemHTML(project, item, index) {
            return `
                <div class="model-item" data-id="${item.id}">
                    <div class="item-header">
                        <span class="item-title">åŸºåº§æ¨¡å‹ #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'models', '${item.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>æ¨¡å‹åç§°ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼šGPT-4" value="${item.name || ''}" onchange="updateModelField('${project}', '${item.id}', 'name', this.value)">
                    </div>
                    <div class="input-group">
                        <label>å‚æ•°è§„æ¨¡ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼š175B" value="${item.params || ''}" onchange="updateModelField('${project}', '${item.id}', 'params', this.value)">
                    </div>
                    <div class="input-group">
                        <label>ç‰ˆæœ¬å·ï¼š</label>
                        <input type="text" placeholder="ä¾‹å¦‚ï¼šv2.0" value="${item.version || ''}" onchange="updateModelField('${project}', '${item.id}', 'version', this.value)">
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">æ¥è‡ªæ•°æ®ï¼š</span>
                        <select multiple id="${item.id}-from-data" onchange="updateModelRelation('${project}', '${item.id}', 'from')">
                            <option value="none">æ— </option>
                        </select>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">è¾“å‡ºåˆ°èƒ½åŠ›æ¨¡å‹ï¼š</span>
                        <select multiple id="${item.id}-to-capabilities" onchange="updateModelRelation('${project}', '${item.id}', 'toCapabilities')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥è¾“å‡ºåˆ°äº§å“ï¼š</span>
                        <select multiple id="${item.id}-to-products" onchange="updateModelRelation('${project}', '${item.id}', 'toProducts')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
            `;
        }
        
        // åˆ›å»ºèƒ½åŠ›æ¨¡å‹HTML
        function createCapabilityItemHTML(project, item, index) {
            return `
                <div class="capability-item" data-id="${item.id}">
                    <div class="item-header">
                        <span class="item-title">èƒ½åŠ›æ¨¡å‹ #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'capabilities', '${item.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>èƒ½åŠ›æ¨¡å‹åç§°ï¼š</label>
                        <input type="text" placeholder="è¾“å…¥èƒ½åŠ›æ¨¡å‹åç§°" value="${item.name || ''}" onchange="updateCapabilityField('${project}', '${item.id}', 'name', this.value)">
                    </div>
                    <div class="input-group">
                        <label>æè¿°ï¼š</label>
                        <textarea placeholder="æè¿°è¯¥èƒ½åŠ›æ¨¡å‹çš„åŠŸèƒ½å’Œç‰¹ç‚¹" onchange="updateCapabilityField('${project}', '${item.id}', 'description', this.value)">${item.description || ''}</textarea>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">æ¥è‡ªåŸºåº§æ¨¡å‹ï¼š</span>
                        <select multiple id="${item.id}-from-models" onchange="updateCapabilityRelation('${project}', '${item.id}', 'from')">
                            <option value="none">æ— </option>
                        </select>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥æ¥è‡ªæ•°æ®ï¼š</span>
                        <select multiple id="${item.id}-from-data" onchange="updateCapabilityRelation('${project}', '${item.id}', 'fromData')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                
                    <div class="relation-select">
                        <span class="relation-label">è¾“å‡ºåˆ°äº§å“ï¼š</span>
                        <select multiple id="${item.id}-to-products" onchange="updateCapabilityRelation('${project}', '${item.id}', 'to')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
            `;
        }
        
        // åˆ›å»ºäº§å“HTML
        function createProductItemHTML(project, item, index) {
            let optionsHtml = '<option value="">è¯·é€‰æ‹©äº§å“</option>';
            productOptions.forEach(opt => {
                const selected = opt.value === item.type ? 'selected' : '';
                optionsHtml += `<option value="${opt.value}" ${selected}>${opt.label}</option>`;
            });
            
            return `
                <div class="product-item" data-id="${item.id}">
                    <div class="item-header">
                        <span class="item-title">äº§å“ #${index}</span>
                        <button class="remove-btn" onclick="removeItem('${project}', 'products', '${item.id}')">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>é€‰æ‹©äº§å“ï¼š</label>
                        <select onchange="updateProductField('${project}', '${item.id}', 'type', this.value)">
                            ${optionsHtml}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>äº§å“æè¿°ï¼š</label>
                        <textarea placeholder="æè¿°äº§å“ç‰¹ç‚¹" onchange="updateProductField('${project}', '${item.id}', 'description', this.value)">${item.description || ''}</textarea>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">æ¥æºäºèƒ½åŠ›æ¨¡å‹ï¼š</span>
                        <select multiple id="${item.id}-from-capabilities" onchange="updateProductRelation('${project}', '${item.id}', 'fromCapabilities')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                    <div class="relation-select">
                        <span class="relation-label">ç›´æ¥æ¥æºäºåŸºåº§æ¨¡å‹ï¼š</span>
                        <select multiple id="${item.id}-from-models" onchange="updateProductRelation('${project}', '${item.id}', 'fromModels')">
                            <option value="none">æ— </option>
                        </select>
                        <small style="color: #6c757d;">æŒ‰ä½Ctrl/Cmdå¤šé€‰</small>
                    </div>
                </div>
            `;
        }
        
        // ç”Ÿæˆæ±‡æ€»
        function generateSummary() {
            const container = document.getElementById('summary-content');
            
            // æ”¶é›†æ‰€æœ‰äº§å“
            const allProducts = {};
            
            ['sh', 'sc', 'bm', 'sr', 'wr'].forEach(project => {
                const data = projectData[project];
                
                data.products.forEach(product => {
                    if (!product.type) return;
                    
                    if (!allProducts[product.type]) {
                        allProducts[product.type] = [];
                    }
                    
                    // è¿½æº¯äº§å“çš„å®Œæ•´è·¯å¾„
                    const trace = traceProduct(project, product);
                    
                    allProducts[product.type].push({
                        project: projectNames[project],
                        projectId: project,
                        product: product,
                        trace: trace
                    });
                });
            });
            
            // ç”ŸæˆHTML
            let html = '';
            
            if (Object.keys(allProducts).length === 0) {
                html = '<div class="no-data">æš‚æ— äº§å“æ•°æ®</div>';
            } else {
                productOptions.forEach(option => {
                    if (allProducts[option.value]) {
                        html += `
                            <div class="product-summary">
                                <div class="product-title">${option.label}</div>
                                ${allProducts[option.value].map(item => `
                                    <div class="trace-path">
                                        <h4 style="color: #667eea; margin-bottom: 10px;">æ¥è‡ªé¡¹ç›®: ${item.project}</h4>
                                        ${item.product.description ? `<p style="color: #666; margin-bottom: 15px; font-style: italic;">${item.product.description}</p>` : ''}
                                        
                                        ${item.trace.capabilities.length > 0 ? `
                                            <div class="trace-step">
                                                <div class="trace-step-title">ğŸ¯ èƒ½åŠ›æ¨¡å‹</div>
                                                ${item.trace.capabilities.map(cap => `
                                                    <div class="trace-item">
                                                        <div class="trace-item-name">${cap.name || 'æœªå‘½åèƒ½åŠ›æ¨¡å‹'}</div>
                                                        ${cap.description ? `<div class="trace-item-detail">æè¿°: ${cap.description}</div>` : ''}
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : '<div style="color: #999; margin: 10px 0;">æ— èƒ½åŠ›æ¨¡å‹å…³è”</div>'}
                                        
                                        ${item.trace.models.length > 0 ? `
                                            <div class="trace-step">
                                                <div class="trace-step-title">ğŸ§  åŸºåº§æ¨¡å‹</div>
                                                ${item.trace.models.map(model => `
                                                    <div class="trace-item">
                                                        <div class="trace-item-name">${model.name || 'æœªå‘½åæ¨¡å‹'}</div>
                                                        <div class="trace-item-detail">
                                                            ${model.params ? `å‚æ•°è§„æ¨¡: ${model.params}` : ''} 
                                                            ${model.params && model.version ? ' | ' : ''}
                                                            ${model.version ? `ç‰ˆæœ¬: ${model.version}` : ''}
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : '<div style="color: #999; margin: 10px 0;">æ— åŸºåº§æ¨¡å‹å…³è”</div>'}
                                        
                                        ${item.trace.data.length > 0 ? `
                                            <div class="trace-step">
                                                <div class="trace-step-title">ğŸ“Š æ•°æ®æ¥æº</div>
                                                ${item.trace.data.map(data => `
                                                    <div class="trace-item">
                                                        <div class="trace-item-name">
                                                            ${data.name || 'æœªå‘½åæ•°æ®'}
                                                            <span class="tag ${data.source === 'internal' ? 'tag-internal' : 'tag-external'}">
                                                                ${data.source === 'internal' ? 'å†…éƒ¨' : 'å¤–éƒ¨'}
                                                            </span>
                                                        </div>
                                                        ${data.volume ? `<div class="trace-item-detail">æ•°æ®é‡: ${data.volume}</div>` : ''}
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : '<div style="color: #999; margin: 10px 0;">æ— æ•°æ®æ¥æºå…³è”</div>'}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                });
            }
            
            container.innerHTML = html;
        }
        
        // è¿½æº¯äº§å“è·¯å¾„ - æ”¹è¿›ç‰ˆ:æœ‰ä»€ä¹ˆæ˜¾ç¤ºä»€ä¹ˆ,ä¸å¼ºåˆ¶å®Œæ•´é“¾è·¯
    function traceProduct(project, product) {
        const result = {
            capabilities: [],
            models: [],
            data: []
        };
        
        const projectDataRef = projectData[project];
        
        // ç¬¬ä¸€æ­¥:æ”¶é›†ç›´æ¥è¿æ¥çš„èƒ½åŠ›æ¨¡å‹
        if (product.fromCapabilities && product.fromCapabilities.length > 0) {
            product.fromCapabilities.forEach(capId => {
                const cap = projectDataRef.capabilities.find(c => c.id === capId);
                if (cap && !result.capabilities.find(c => c.id === cap.id)) {
                    result.capabilities.push(cap);
                }
            });
        }
        
        // ç¬¬äºŒæ­¥:æ”¶é›†ç›´æ¥è¿æ¥çš„åŸºåº§æ¨¡å‹
        if (product.fromModels && product.fromModels.length > 0) {
            product.fromModels.forEach(modelId => {
                const model = projectDataRef.models.find(m => m.id === modelId);
                if (model && !result.models.find(m => m.id === model.id)) {
                    result.models.push(model);
                }
            });
        }
        
        // ç¬¬ä¸‰æ­¥:ä»èƒ½åŠ›æ¨¡å‹è¿½æº¯åˆ°åŸºåº§æ¨¡å‹
        result.capabilities.forEach(cap => {
            if (cap.fromModels && cap.fromModels.length > 0) {
                cap.fromModels.forEach(modelId => {
                    const model = projectDataRef.models.find(m => m.id === modelId);
                    if (model && !result.models.find(m => m.id === model.id)) {
                        result.models.push(model);
                    }
                });
            }
        });
        
        // ç¬¬å››æ­¥:ä»èƒ½åŠ›æ¨¡å‹ç›´æ¥è¿½æº¯åˆ°æ•°æ®
        result.capabilities.forEach(cap => {
            if (cap.fromData && cap.fromData.length > 0) {
                cap.fromData.forEach(dataId => {
                    const data = projectDataRef.data.find(d => d.id === dataId);
                    if (data && !result.data.find(d => d.id === data.id)) {
                        result.data.push(data);
                    }
                });
            }
        });
        
        // ç¬¬äº”æ­¥:ä»åŸºåº§æ¨¡å‹è¿½æº¯åˆ°æ•°æ®
        result.models.forEach(model => {
            if (model.fromData && model.fromData.length > 0) {
                model.fromData.forEach(dataId => {
                    const data = projectDataRef.data.find(d => d.id === dataId);
                    if (data && !result.data.find(d => d.id === data.id)) {
                        result.data.push(data);
                    }
                });
            }
        });
        
        return result;
    };
            
            const projectDataRef = projectData[project];
            
            // è·å–èƒ½åŠ›æ¨¡å‹
            if (product.fromCapabilities) {
                product.fromCapabilities.forEach(capId => {
                    const cap = projectDataRef.capabilities.find(c => c.id === capId);
                    if (cap) {
                        result.capabilities.push(cap);
                        
                        // è·å–åŸºåº§æ¨¡å‹
                        cap.fromModels.forEach(modelId => {
                            const model = projectDataRef.models.find(m => m.id === modelId);
                            if (model && !result.models.find(m => m.id === model.id)) {
                                result.models.push(model);
                                
                                // è·å–æ•°æ®
                                model.fromData.forEach(dataId => {
                                    const data = projectDataRef.data.find(d => d.id === dataId);
                                    if (data && !result.data.find(d => d.id === data.id)) {
                                        result.data.push(data);
                                    }
                                });
                            }
                        });
                    }
                });
            }
            
            // è·å–ç›´æ¥æ¥è‡ªåŸºåº§æ¨¡å‹çš„äº§å“
            if (product.fromModels) {
                product.fromModels.forEach(modelId => {
                    const model = projectDataRef.models.find(m => m.id === modelId);
                    if (model && !result.models.find(m => m.id === model.id)) {
                        result.models.push(model);
                        
                        // è·å–æ•°æ®
                        model.fromData.forEach(dataId => {
                            const data = projectDataRef.data.find(d => d.id === dataId);
                            if (data && !result.data.find(d => d.id === data.id)) {
                                result.data.push(data);
                            }
                        });
                    }
                });
            }
            
            return result;
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            // ä¸ºæ¯ä¸ªé¡¹ç›®åŠ è½½æ•°æ®
            ['sh', 'sc', 'bm', 'sr', 'wr'].forEach(project => {
                loadProject(project);
            });
        });
    </script>
</body>
</html>
